<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Basic Static Techniques - Notes & Labs - Pablo de Juan Fidalgo</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Table of Contents Notes Hashing: A Fingerprint for Malware Finding Strings Packed and Obfuscated Malware Labs Lab 1 Lab 2 Lab 3 Lab 4 Notes Hashing: A Fingerprint for Malware We will use HashCalc tool.
Finding Strings For this task we will use FLOSS (FLARE Obfuscated String Solver) tool
Packed and Obfuscated Malware Packed and obfuscated code will often include at least the functions LoadLibrary and GetProcAddress, which are used to load and gain access to additional functions."><meta property="og:image" content><meta property="og:title" content="Basic Static Techniques - Notes & Labs"><meta property="og:description" content="Table of Contents Notes Hashing: A Fingerprint for Malware Finding Strings Packed and Obfuscated Malware Labs Lab 1 Lab 2 Lab 3 Lab 4 Notes Hashing: A Fingerprint for Malware We will use HashCalc tool.
Finding Strings For this task we will use FLOSS (FLARE Obfuscated String Solver) tool
Packed and Obfuscated Malware Packed and obfuscated code will often include at least the functions LoadLibrary and GetProcAddress, which are used to load and gain access to additional functions."><meta property="og:type" content="article"><meta property="og:url" content="https://pabdj.github.io/posts/basicstatictechniques_notesandlabs/basicstatictechniques_notesandlabs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-12-08T12:50:58+05:30"><meta property="article:modified_time" content="2022-12-08T12:50:58+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Basic Static Techniques - Notes & Labs"><meta name=twitter:description content="Table of Contents Notes Hashing: A Fingerprint for Malware Finding Strings Packed and Obfuscated Malware Labs Lab 1 Lab 2 Lab 3 Lab 4 Notes Hashing: A Fingerprint for Malware We will use HashCalc tool.
Finding Strings For this task we will use FLOSS (FLARE Obfuscated String Solver) tool
Packed and Obfuscated Malware Packed and obfuscated code will often include at least the functions LoadLibrary and GetProcAddress, which are used to load and gain access to additional functions."><script src=https://pabdj.github.io/js/feather.min.js></script>
<link href=https://pabdj.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://pabdj.github.io/css/main.0fd5f05032e8d6d12808eb2d48a5a295f4ee5cd8eefd5bf3dbfd49a346d206ed.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://pabdj.github.io/css/dark.73617b6be66d271725422ddf83ec3f8c57af298005233c552735d43adf634f04.css disabled></head><body><div class=content><header><div class=main><a href=https://pabdj.github.io/>Pablo de Juan Fidalgo</a></div><nav><a href=/>Home</a>
<a href=/posts>Blog</a>
<a href=/tags>Tags</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://pabdj.github.io/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Basic Static Techniques - Notes & Labs</h1><div class=meta>Posted on Dec 8, 2022</div></div><section class=body><h2 id=table-of-contents>Table of Contents</h2><ol><li><a href=#notes>Notes</a><ol><li><a href=#hashing-a-fingerprint-for-malware>Hashing: A Fingerprint for Malware</a></li><li><a href=#finding-strings>Finding Strings</a></li><li><a href=#packed-and-obfuscated-malware>Packed and Obfuscated Malware</a></li></ol></li><li><a href=#labs>Labs</a><ol><li><a href=#lab-1>Lab 1</a></li><li><a href=#lab-2>Lab 2</a></li><li><a href=#lab-3>Lab 3</a></li><li><a href=#lab-4>Lab 4</a></li></ol></li></ol><h2 id=notes>Notes</h2><h3 id=hashing-a-fingerprint-for-malware>Hashing: A Fingerprint for Malware</h3><p>We will use <strong>HashCalc</strong> tool.</p><h3 id=finding-strings>Finding Strings</h3><p>For this task we will use FLOSS (FLARE Obfuscated String Solver) tool</p><h3 id=packed-and-obfuscated-malware>Packed and Obfuscated Malware</h3><ul><li>Packed and obfuscated code will often include at least the functions <strong><em>LoadLibrary</em></strong> and <strong><em>GetProcAddress</em></strong>, which are used to load and gain access to additional functions.</li><li><a href=https://upx.github.io/>UPX: the Ultimate Packer for eXecutables</a></li><li>Several Microsoft Windows functions allow programmers to import linked functions not listed in a program&rsquo;s file header. Of these, the two most commonly used are <strong><em>LoadLibrary</em></strong> and <strong><em>GetProcAddress</em></strong>. <strong><em>LdrGetProcAddress</em></strong> and <strong><em>LdrLoadDll</em></strong> are also used.</li></ul><figure><img src=../CommonDLLs.png><figcaption><h4>Common DLLs</h4></figcaption></figure><ul><li>When Microsoft updates a function and the new function is incompatible with the old one, Microsoft continues to support the old function. The new function is given the same name as the old function, with an added Ex suffix.</li><li>Many functions that take strings as parameters include an A or a W at the end of their names. This letter does not appear in the documentation for the function; it simply indicates that the function accepts a string parameter and that there are two different versions of the function: one for ASCII strings and one for wide character strings.</li><li><strong><em>SetWindowsHookEx</em></strong> is commonly used in spyware and is the most popular way that keyloggers receive keyboard inputs</li></ul><h2 id=labs>Labs</h2><h3 id=lab-1>Lab 1</h3><p><strong>2. When were these files compiled?</strong></p><p>We can observe the exact date with CFF Explorer tool. Lab01-01.exe and Lab01-01.dll were compiled on 2010/12/19 Sunday 16:16 UTC</p><p><strong>3. Are there any indications that either of these files is packed or obfuscated? If so, what are these indicators?</strong></p><p>One way to detect packed files is with the PEiD program. In this case, both files do not seem to be packed.</p><p><strong>4. Do any imports hint at what this malware does? If so, which imports are they?</strong></p><p>With CFF Explorer we can look at Lab01-01.exe imports. In the following picture we can observe them:<figure><img src=../1-4.png></figure></p><p>As we are dealing with a DLL file, the most common thing would be that the malware is a rootkit. In this case, the .exe file tries to substitute the authentic DLL with a malicious one. For this task, the .exe imports some functions such as FindFirstFile, FindNextFile, CreateFile, CreateFileMapping, MapViewOfFile and UnmapViewOfFile.</p><p><strong>5. Are there any other files or host-based indicators that you could look for on infected systems?</strong></p><p>FLOSS tool provides the strings linked to the .exe file. Thanks to that we can observe that the malware tries to hide the malicious DLL playing with the similarity between letter “l” and number “1”. Its name is kerne132.dll instead of kernel32.dll.</p><p><strong>6. What network-based indicators could be used to find this malware on infected machines?</strong></p><p>The .dll contains an IP address (127.26.152[.]13) which could be useful for detecting if other machines make connections to that IP. In this case it is a localhost IP.</p><p><strong>7. What would you guess is the purpose of these files?</strong></p><p>Rootkit.</p><h3 id=lab-2>Lab 2</h3><p><strong>2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.</strong></p><p>When we try to load the file into CFF Explorer, the file info shows UPX v3.0 which is a famous packer. In fact, this packer was mentioned in the chapter.</p><p>For unpacking it we just have to run the following command: <code>upx -d Lab01-02.exe</code></p><p><strong>3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?</strong></p><figure><img src=../2-3.png></figure><p>The sample imports WININET library which is used for implementing higher-networking protocols such as HTTP. We have to take into account that the sample is packed so guessing program’s functionality is not straightforward.</p><p><strong>4. What host- or network-based indicators could be used to identify this malware on infected machines?</strong></p><p>After unpacking we can observe that the malware sample connects to the following URL: hxxp://malwareanalysisbook[.]com and it creates a process called MalService.</p><h3 id=lab-3>Lab 3</h3><p><strong>2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.</strong></p><p>We can observe that the file is packed with FSG 1.0 dulek/xt.</p><p>As we have not covered yet the process of unpacking malware samples that have not been packed with UPX we are not supposed to know this.</p><p><strong>3. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?</strong></p><p>As we have not unpacked the sample, we cannot make further analysis.</p><p><strong>4. What host- or network-based indicators could be used to identify this malware on infected machines?</strong></p><p>As we have not unpacked the sample, we cannot make further analysis.</p><h3 id=lab-4>Lab 4</h3><p><strong>2. Are there any indications that this file is packed or obfuscated? If so, what are these indicators? If the file is packed, unpack it if possible.</strong></p><p>The file does not seem to be packed.</p><p><strong>3. When was this program compiled?</strong></p><p>The program was compiled on Friday 30th August 2019 at 22:26</p><p>Compilation times can be faked, and I think that this is the case as <em>Practical Malware Analysis</em> book was written in 2011. Malware sample from the future? 😉</p><p><strong>4. Do any imports hint at this program’s functionality? If so, which imports are they and what do they tell you?</strong></p><p>After observing some imports we can think that we are dealing with a sample that performs process injection. This hypothesis is supported by the different imports from the program such as <em>GetCurrentProcess</em>, <em>GetProcessAddress</em>, <em>OpenProcess</em> and <em>CreateRemoteThread.</em></p><p><strong>5. What host- or network-based indicators could be used to identify this malware on infected machines?</strong></p><p>If we take a look at the strings, we can see some malicious programs such as <em>winup.exe</em> and <em>wupdmgr.exe</em> and malicious URLs such as hxxp://practicalmalwareanalysis[.]com/updater.exe</p><p><strong>6. This file has one resource in the resource section. Use Resource Hacker to examine that resource, and then use it to extract the resource. What can you learn from the resource?</strong></p><p>After taking a look again at the imports we can see that there are some suspicious calls such as <em>FindResourceA</em>, <em>LoadResource</em> and <em>SizeofResource</em>.</p><p>I have learnt that with ResourceHacker we can convert the binary data to another .exe file and then perform another analysis to that sample. As it is stated in the solutions, the original file brings another sample attached, which is the one that downloads more malware from the URLs that we found before (it contains <em>suspicious</em> imports like <em>URLDownloadToFile</em>).</p></section><div class=post-tags><nav class="nav tags"><h2 class=title>Tags</h2><ul class=tags><li><a href=/tags/practical-malware-analysis>practical malware analysis</a></li><li><a href=/tags/malware>malware</a></li><li><a href=/tags/reversing>reversing</a></li><li><a href=/tags/basic>basic</a></li><li><a href=/tags/static>static</a></li><li><a href=/tags/analysis>analysis</a></li><li><a href=/tags/unpacking>unpacking</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/pabdj title=GitHub><i data-feather=github></i></a>
<a class=border></a><a class=soc href=https://twitter.com/pabdjf title=Twitter><i data-feather=twitter></i></a>
<a class=border></a><a class=soc href=https://es.linkedin.com/in/pablodejuanfidalgo title=LinkedIn><i data-feather=linkedin></i></a>
<a class=border></a></div><div class=footer-info>2023 © Pablo de Juan Fidalgo |</div></footer><script>feather.replace()</script></div></body></html>